{% extends "mhs/base.html" %}
{% load static %}

{% block title %}Subbab 2 - Pengertian Spatial Filtering{% endblock %}

{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

<style>
  .card-section {
    border: 2px solid #bcccdc;
    border-radius: 12px;
    overflow: hidden;
    background: #ffffff;
    margin-bottom: 22px;
    box-shadow: 0 6px 18px rgba(16,32,58,0.03);
  }
  .card-section-header {
    padding: 14px 18px;
    font-size: 20px;
    font-weight: 800;
    display:flex;
    align-items:center;
    gap:12px;
    background: #edf4fe;
    border-bottom: 2px solid #bcccdc;
  }
  .card-section-header i {
    font-size:20px;
    color:var(--primary-500);
    display:inline-flex;
    width:36px;
    height:36px;
    align-items:center;
    justify-content:center;
    border-radius:8px;
    background: rgba(59,123,227,0.12);
  }
  .card-section-body {
    padding: 35px;
    font-size: 19px;
    color: #222f3a;
    background: #fff;
  }
  .card-section-body p { margin-bottom:12px; line-height:1.6; }
  .card-section-body ol { margin-top:8px; padding-left:35px; }
  .card-section-body li { margin-bottom:12px; font-size:19px; }
  .option-btn {
    display: block;
    width: 100%;
    text-align: left;
    margin-bottom: 8px;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid rgba(16,32,58,0.1);
    background: #fff;
    transition: all 0.2s;
    cursor: pointer;
  }
  #quiz-card {
    border: 2.5px solid #4d7bdc !important;
    box-shadow: 0 10px 25px rgba(59, 123, 227, 0.15) !important;
  }

  #quiz-card .card-section-header {
    background: #4d7bdc !important;
    border-bottom: 2px solid #4d7bdc; 
    color: white !important;
  }

  #quiz-card .card-section-header i {
    background: rgba(255, 255, 255, 0.2) !important;
    color: white !important;
  }
  .option-label { font-weight: 800; margin-right: 10px; color: #000000; }
  .material-nav {
    display:flex;
    gap:12px;
    justify-content:flex-end;
    margin-top:18px;
    margin-bottom:34px;
  }
  @media (max-width:767px){
    .card-section-header { font-size:16px; }
    .card-section-body { padding:16px; font-size:15.5px; }
    .material-nav { justify-content:stretch; flex-direction:column-reverse; }
  }
</style>

<div class="mb-3">
  <h1 class="title-main">SUBBAB 2 - <span style="color:var(--primary-500)">PENGERTIAN <em>SPATIAL FILTERING</em></span></h1>
</div>

<section class="card-section" aria-labelledby="tujuan-heading">
  <div class="card-section-header">
    <i class="bi bi-journal-bookmark"></i>
    <div id="tujuan-heading">Tujuan Pembelajaran</div>
  </div>
  <div class="card-section-body">
    <p class="muted">Setelah menyelesaikan pembelajaran pada bab ini, mahasiswa diharapkan mampu:</p>
    <ol>
      <li>Memahami apa itu <em>Spatial Filtering</em> pada citra digital.</li>
      <li>Memahami manfaat <em>Spatial Filtering</em> dalam pemrosesan citra digital.</li>
      <li>Menganalisis perbedaan proses <em>filtering</em> pada <em>Spatial Domain</em> dan <em>Frequency Domain</em>.</li>
    </ol>
  </div>
</section>

<section class="card-section" aria-labelledby="materi-heading">
  <div class="card-section-header">
    <i class="bi bi-grid-3x3"></i>
    <div id="materi-heading">Pengertian <em>Spatial Filtering</em></div>
  </div>

  <div class="card-section-body">
    <p style="text-align: justify; text-indent: 30px;">
      Dalam kehidupan sehari-hari kita mungkin pernah melihat gambar yang tampak buram, terlalu gelap, atau dipenuhi bintik-bintik kecil seperti debu pada foto lama. 
      Kondisi tersebut menunjukkan bahwa kualitas citra kurang baik sehingga diperlukan pemrosesan citra agar tampilannya menjadi lebih jernih dan mudah dikenali. 
      Salah satu pendekatan yang umum digunakan dalam pemrosesan citra digital untuk tujuan tersebut adalah <em>spatial filtering</em>.
    </p>

    <p style="text-align: justify; text-indent: 30px;">
      <strong><em>Spatial filtering</em></strong> dapat diibaratkan seperti membersihkan kaca jendela yang kotor. 
      Pendekatan ini bekerja pada <em>spatial domain</em>, yaitu dengan memproses langsung nilai intensitas piksel pada area citra yang sedang diproses. 
      Ketika kaca jendela dipenuhi debu, pemandangan di luar terlihat buram. Setelah dibersihkan, pemandangan menjadi lebih jelas dan nyaman dilihat. 
      Prinsip ini serupa dengan <em>smoothing filter</em> yang digunakan untuk mengurangi <em>noise</em> atau gangguan kecil pada citra (lihat Gambar B.1).
    </p>

    <figure style="margin:20px 0;">
      <img src="{% static 'assets/img/konten/1B.png' %}" style="display:block; margin:auto; width:80%;">
      <figcaption style="color:#7f7f7f; margin-top:8px; text-align:center; font-weight:normal;">
        Gambar B.1 Ilustrasi prinsip <em>smoothing</em> dan <em>sharpening</em> pada <em>Spatial Filtering</em>
      </figcaption>
    </figure>

    <p style="text-align: justify; text-indent: 30px;">
      Setelah citra menjadi lebih bersih, terkadang diperlukan proses penajaman agar detail penting seperti tepi objek, bentuk daun, atau pagar terlihat lebih jelas. 
      Pada tahap ini digunakan <em>sharpening filter</em> untuk menonjolkan tepi dan detail sehingga citra tampak lebih tajam dan informatif. 
      Dengan demikian, <strong><em>spatial filtering</em> tidak hanya berfungsi untuk menghaluskan citra, tetapi juga untuk meningkatkan ketajaman detail visual</strong>.
    </p>

    <p style="text-align: justify; text-indent: 30px;">
      Secara teknis, <em>spatial filtering</em> bekerja dengan memperhatikan nilai suatu piksel dan piksel-piksel di sekitarnya. 
      <strong>Nilai piksel dapat berubah karena dipengaruhi oleh nilai tetangganya. Proses ini dikenal sebagai <em>neighbourhood operation</em></strong>, 
      yaitu operasi yang menentukan nilai piksel baru berdasarkan nilai piksel-piksel tetangga di sekitar piksel pusat. 
      Melalui teknik tersebut, citra baru dihasilkan sesuai dengan tujuan pemrosesan, baik untuk mengurangi <em>noise</em>, menghaluskan tampilan, maupun menajamkan detail objek.
    </p>

    <p style="text-align: justify; text-indent: 30px;">
      Sebagai ilustrasi, pada Gambar B.2 ditunjukkan contoh citra berukuran 6×6 yang terdiri atas nilai intensitas piksel. 
      Piksel yang berada di tengah disebut sebagai piksel pusat, yaitu piksel yang sedang diproses, sedangkan piksel-piksel di sekelilingnya merupakan piksel tetangga yang memengaruhi hasil perhitungan. 
      Dengan memanfaatkan nilai-nilai piksel tersebut, proses <em>spatial filtering</em> dapat menghasilkan citra baru sesuai tujuan pemrosesan.
    </p>

    <figure style="margin:20px 0;">
      <img src="{% static 'assets/img/konten/2B.png' %}" style="display:block; margin:auto; width:80%;">
      <figcaption style="color:#7f7f7f; margin-top:8px; text-align:center; font-weight:normal;">
        Gambar B.2 Ilustrasi piksel pusat dan delapan piksel tetangganya pada ukuran 3×3
      </figcaption>
    </figure>
  </div>
</section>

<section class="card-section" aria-labelledby="materi-heading">
  <div class="card-section-header">
    <i class="bi bi-image-alt"></i>
    <div id="materi-heading">Penerapan <em>Spatial Filtering</em> pada Citra</div>
  </div>

  <div class="card-section-body">
    <p style="text-align: justify; text-indent: 30px;">
      Pada Gambar B.3 ditunjukkan dua jenis citra yang mengalami gangguan (<em>noise</em>). 
      Citra di sebelah kiri menunjukkan Gaussian <em>noise</em> yang tampak seperti butiran halus menyebar merata di seluruh gambar. 
      Sedangkan citra di sebelah kanan menunjukkan <em>salt and pepper noise</em> yang berbentuk bintik-bintik hitam dan putih acak seperti taburan garam dan merica.
    </p>

    <figure style="margin:20px 0;">
      <img src="{% static 'assets/img/konten/3B.png' %}" style="display:block; margin:auto; width:95%;">
      <figcaption style="color:#7f7f7f; margin-top:8px; text-align:center; font-weight:normal;">
        Gambar B.3 Citra yang mengalami gangguan (<em>noise</em>)
      </figcaption>
    </figure>

    <p style="text-align: justify; text-indent: 30px;">
      Dengan memanfaatkan <em>spatial filtering</em> berbagai jenis gangguan pada citra dapat dikurangi. 
      Misalnya <em>mean filter</em> mengganti nilai piksel dengan rata-rata dari piksel di sekitarnya sehingga Gaussian <em>noise</em> dapat tersamarkan. 
      Sementara itu <em>median filter</em> lebih efektif untuk menghilangkan <em>salt and pepper noise</em> tanpa merusak tepi objek penting dalam gambar. 
      Contoh hasil penerapan kedua filter tersebut dapat dilihat pada Gambar B.4.
    </p>

    <figure style="margin:20px 0;">
      <img src="{% static 'assets/img/konten/4B.png' %}" style="display:block; margin:auto; width:95%;">
      <figcaption style="color:#7f7f7f; margin-top:8px; text-align:center; font-weight:normal;">
        Gambar B.4 Hasil citra ber-<em>noise</em> setelah diterapkan proses filtering
      </figcaption>
    </figure>

    <p style="text-align: justify; text-indent: 30px;">
      Pada Gambar B.4 terlihat bahwa hasil <em>median filter</em> tampak lebih halus dan bersih dibandingkan dengan <em>mean filter</em>. 
      Hal ini karena <em>median filter</em> bekerja dengan memilih nilai tengah dari piksel-piksel di sekitarnya, sehingga lebih mampu mempertahankan bentuk tepi objek sekaligus menghilangkan <em>noise</em> berupa titik-titik hitam dan putih. 
      Sebaliknya, <em>mean filter</em> cenderung membuat citra tampak agak kabur karena proses perataannya menghitung rata-rata semua piksel di sekitar tanpa memilah mana yang terlalu jauh atau terlalu berbeda dari nilai aslinya. Akibatnya detail halus pada objek ikut melemah. 
      Oleh sebab itu jika citra memiliki <em>noise</em> berupa titik-titik seperti <em>salt and pepper</em>, <em>median filter</em> biasanya memberikan hasil yang lebih baik dibandingkan <em>mean filter</em>.
    </p>

    <p style="text-align: justify; text-indent: 30px;">
      Selain berfungsi untuk menghaluskan citra dengan cara mengurangi <em>noise</em>, <em>spatial filtering</em> juga dapat digunakan untuk menajamkan citra (<em>image sharpening</em>). 
      Tujuan dari proses ini adalah untuk menonjolkan tepi dan detail penting pada gambar agar tampil lebih jelas dan tajam. 
      Teknik ini tidak hanya membantu memperbaiki kualitas gambar, tetapi juga memperjelas detail visual yang ada di dalamnya.
    </p>
  </div>
</section>


<section class="card-section" id="quiz-card">
  <div class="card-section-header">
    <i class="bi bi-question-circle"></i>
    <div>Aktivitas 1</div>
  </div>
  <div class="card-section-body">
    <p class="muted">Pilih jawaban yang paling tepat. Jika jawaban belum tepat, silakan coba lagi sampai benar.</p>
    <div id="question-counter" style="font-weight:700; margin-bottom:12px;">Soal 1 / 5</div>
    
    <div id="question-area">
      <div id="question-text" style="font-weight:800; font-size:18px; margin-bottom:15px;"></div>
      <div id="options-container"></div>
    </div>
    <div id="quiz-feedback" style="min-height:48px; margin-top:15px;"></div>
    <div style="margin-top:20px;">
      <button id="next-quiz-btn" class="btn btn-primary" disabled>Selanjutnya</button>
    </div>
  </div>
</section>

<div class="material-nav">
  <a href="{% url 'ringkasan_citra' %}" class="btn btn-outline-secondary"><i class="bi bi-chevron-left"></i> Sebelumnya</a>
  <a id="nav-next-materi" href="{% url 'spatial_frequency' %}" 
     class="btn btn-primary {% if 'pengertian-spatial' not in selesai_slugs %}disabled{% endif %}" 
     style="{% if 'pengertian-spatial' not in selesai_slugs %}opacity: 0.5; pointer-events: none;{% endif %}">
    Selanjutnya <i class="bi bi-chevron-right"></i>
  </a>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<script>
(function() {
  const currentSlug = 'pengertian-spatial';
  const questions = [
    {
      q: "Tujuan utama penggunaan spatial filtering dalam pemrosesan citra digital adalah ….",
      opts: ["memodifikasi ukuran citra untuk meningkatkan ketajaman tampilan","memodifikasi representasi citra ke dalam domain frekuensi untuk memperjelas detail","memodifikasi model warna citra untuk meningkatkan kualitas visual","memodifikasi nilai intensitas piksel secara langsung untuk meningkatkan kualitas citra","memodifikasi resolusi citra dengan menambah jumlah piksel"],
      ans: "memodifikasi nilai intensitas piksel secara langsung untuk meningkatkan kualitas citra",
      explain: "spatial filtering bekerja pada spatial domain dengan memodifikasi nilai intensitas piksel secara langsung berdasarkan piksel di sekitarnya untuk meningkatkan kualitas citra."
    },
    {
      q: "Proses yang memodifikasi nilai piksel berdasarkan piksel tetangganya dalam spatial domain disebut ….",
      opts: ["neighbourhood operation","frequency transformation","histogram equalization","image compression","thresholding"],
      ans: "neighbourhood operation",
      explain: "neighbourhood operation adalah proses yang memanfaatkan nilai piksel pusat dan piksel-piksel tetangganya."
    },
    {
      q: "Proses spatial filtering dapat dikatakan sebagai operasi langsung pada citra karena ….",
      opts: ["tidak melibatkan perhitungan matematis","tidak membutuhkan kernel","bekerja langsung dengan nilai piksel asli dalam matriks citra","tidak memperhatikan posisi piksel","selalu dilakukan dalam domain frekuensi"],
      ans: "bekerja langsung dengan nilai piksel asli dalam matriks citra",
      explain: "spatial filtering bekerja langsung pada nilai piksel asli di dalam matriks citra, bukan pada hasil transformasi."
    },
    {
      q: "Domain yang digunakan dalam proses spatial filtering adalah ….",
      opts: ["domain frekuensi","domain waktu","domain transformasi","domain biner","domain spasial"],
      ans: "domain spasial",
      explain: "spatial filtering dilakukan pada domain spasial, yaitu dengan memproses nilai piksel berdasarkan posisinya."
    },
    {
      q: "Masalah citra yang tampak dipenuhi bintik-bintik kecil seperti debu disebut ….",
      opts: ["blur","noise","kontras","threshold","segmentasi"],
      ans: "noise",
      explain: "noise adalah gangguan pada citra yang tampak sebagai bintik-bintik acak seperti debu atau titik hitam-putih."
    }
  ];


  let currentIdx = 0;
  const qText = document.getElementById('question-text');
  const optsCont = document.getElementById('options-container');
  const feedback = document.getElementById('quiz-feedback');
  const btnNextQuiz = document.getElementById('next-quiz-btn');
  const btnNavNext = document.getElementById('nav-next-materi');

  function renderQuestion(idx) {
    const item = questions[idx];
    document.getElementById('question-counter').textContent = `Soal ${idx + 1} / ${questions.length}`;
    qText.textContent = item.q;
    optsCont.innerHTML = '';
    feedback.innerHTML = '';
    btnNextQuiz.disabled = true;
    
    const labels = ['a', 'b', 'c', 'd', 'e'];
    item.opts.forEach((opt, i) => {
      const btn = document.createElement('button');
      btn.className = 'option-btn';
      btn.innerHTML = `<span class="option-label">${labels[i]}.</span> ${opt}`;
      btn.onclick = () => {
        Array.from(optsCont.children).forEach(child => {
          child.style.background = '#fff';
          child.style.borderColor = 'rgba(16,32,58,0.1)';
        });
        if (opt === item.ans) {
          btn.style.background = '#e9f2ff';
          btn.style.borderColor = '#3b7be3';
          feedback.innerHTML = `<div style="color:green;font-weight:700">Benar! — ${item.explain}</div>`;
          btnNextQuiz.disabled = false;
          Array.from(optsCont.children).forEach(b => b.style.pointerEvents = 'none');
        } else {
          btn.style.background = '#fff0f0';
          btn.style.borderColor = '#f5c6c6';
          feedback.innerHTML = '<div style="color:#c0392b;font-weight:700">Belum tepat, coba lagi.</div>';
        }
      };
      optsCont.appendChild(btn);
    });
  }

  btnNextQuiz.onclick = () => {
    currentIdx++;
    if (currentIdx < questions.length) {
      renderQuestion(currentIdx);
    } else {
      updateProgressDatabase();
    }
  };

  function updateProgressDatabase() {
    fetch("/api/update-progres/", {
      method: "POST",
      headers: {
        "X-CSRFToken": "{{ csrf_token }}",
        "Content-Type": "application/json",
        "Accept": "application/json"
      },
      body: JSON.stringify({ slug: currentSlug })
    })
    .then(async response => {
        const contentType = response.headers.get("content-type");
        if (!response.ok || !contentType || !contentType.includes("application/json")) {
            throw new Error('Sesi berakhir atau URL tidak ditemukan.');
        }
        return response.json();
    })
    .then(data => {
      if (data.status === 'success') {
        Swal.fire({
          title: 'Luar Biasa!',
          text: 'Semua jawaban kamu benar. Silakan lanjutkan ke materi berikutnya.',
          icon: 'success',
          confirmButtonText: 'OK',
          confirmButtonColor: '#3b7be3'
        }).then(() => {
          btnNavNext.classList.remove('disabled');
          btnNavNext.style.opacity = '1';
          btnNavNext.style.pointerEvents = 'auto';
          
          
          const sidebarLink = document.querySelector(`a[href*="spatial_frequency"]`);
          if (sidebarLink) {
              sidebarLink.classList.remove('locked');
              sidebarLink.style.pointerEvents = 'auto';
              sidebarLink.style.opacity = '1';
          }
          
          currentIdx = 0;
          renderQuestion(0);
        });
      }
    })
    .catch(err => {
        console.error(err);
        Swal.fire('Gagal Simpan', err.message, 'error');
    });
  }

  const sudahSelesai = "{{ selesai_slugs|safe }}".includes(currentSlug);
  if (sudahSelesai) {
    btnNavNext.classList.remove('disabled');
    btnNavNext.style.opacity = '1';
    btnNavNext.style.pointerEvents = 'auto';
  }
  
  renderQuestion(0);
})();
</script>
{% endblock %}